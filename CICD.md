# NotifyHub CI/CD èªªæ˜æ–‡ä»¶

æœ¬å°ˆæ¡ˆä½¿ç”¨ **GitHub Actions + SSH + Shell Script** çš„ CI/CD æ–¹æ¡ˆã€‚
ç•¶ä»£ç¢¼æ¨é€åˆ° GitHub å¾Œï¼ŒGitHub Actions æœƒé€é SSH é€£ç·šåˆ°ä¼ºæœå™¨ï¼ŒåŸ·è¡Œ `git pull` ä¸¦é‹è¡Œéƒ¨ç½²è…³æœ¬ã€‚

## ğŸ—ï¸ æ¶æ§‹èªªæ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      SSH        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GitHub Actions â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚   ä¼ºæœå™¨        â”‚
â”‚                 â”‚                 â”‚                 â”‚
â”‚  1. è§¸ç™¼ CI/CD  â”‚                 â”‚  1. git pull    â”‚
â”‚  2. SSH é€£ç·š    â”‚                 â”‚  2. åŸ·è¡Œ sh     â”‚
â”‚                 â”‚                 â”‚  3. è—ç¶ éƒ¨ç½²    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ ç›¸é—œæª”æ¡ˆ

| æª”æ¡ˆ | èªªæ˜ |
|------|------|
| `.github/workflows/deploy-dev.yml` | é–‹ç™¼ç’°å¢ƒéƒ¨ç½² workflowï¼ˆdevelop åˆ†æ”¯ï¼‰ |
| `.github/workflows/deploy-prod.yml` | ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½² workflowï¼ˆmain åˆ†æ”¯ï¼‰ |
| `deploy.sh` | è—ç¶ éƒ¨ç½²è…³æœ¬ |

## ğŸ”§ GitHub Secrets è¨­å®š

åœ¨ GitHub Repository è¨­å®šä¸­åŠ å…¥ä»¥ä¸‹ Secretsï¼š

### é–‹ç™¼ç’°å¢ƒ (develop åˆ†æ”¯)

| Secret åç¨± | èªªæ˜ | ç¯„ä¾‹ |
|-------------|------|------|
| `DEV_SSH_HOST` | é–‹ç™¼ä¼ºæœå™¨ IP æˆ–åŸŸå | `dev.example.com` |
| `DEV_SSH_USER` | SSH ç™»å…¥å¸³è™Ÿ | `deployer` |
| `DEV_SSH_KEY` | SSH ç§é‘°ï¼ˆå®Œæ•´å…§å®¹ï¼‰ | `-----BEGIN OPENSSH PRIVATE KEY-----...` |
| `DEV_SSH_PORT` | SSH é€£æ¥åŸ ï¼ˆé¸å¡«ï¼Œé è¨­ 22ï¼‰ | `22` |
| `DEV_DEPLOY_PATH` | å°ˆæ¡ˆåœ¨ä¼ºæœå™¨çš„è·¯å¾‘ | `/home/deployer/notifyhub` |

### ç”Ÿç”¢ç’°å¢ƒ (main åˆ†æ”¯)

| Secret åç¨± | èªªæ˜ | ç¯„ä¾‹ |
|-------------|------|------|
| `PROD_SSH_HOST` | ç”Ÿç”¢ä¼ºæœå™¨ IP æˆ–åŸŸå | `prod.example.com` |
| `PROD_SSH_USER` | SSH ç™»å…¥å¸³è™Ÿ | `deployer` |
| `PROD_SSH_KEY` | SSH ç§é‘°ï¼ˆå®Œæ•´å…§å®¹ï¼‰ | `-----BEGIN OPENSSH PRIVATE KEY-----...` |
| `PROD_SSH_PORT` | SSH é€£æ¥åŸ ï¼ˆé¸å¡«ï¼Œé è¨­ 22ï¼‰ | `22` |
| `PROD_DEPLOY_PATH` | å°ˆæ¡ˆåœ¨ä¼ºæœå™¨çš„è·¯å¾‘ | `/home/deployer/notifyhub` |

### è¨­å®šæ­¥é©Ÿ

1. å‰å¾€ GitHub Repository â†’ **Settings** â†’ **Secrets and variables** â†’ **Actions**
2. é»æ“Š **New repository secret**
3. ä¾åºåŠ å…¥ä¸Šè¿° Secrets

### SSH Key ç”Ÿæˆï¼ˆå¦‚æœé‚„æ²’æœ‰ï¼‰

```bash
# åœ¨æœ¬æ©Ÿç”Ÿæˆ SSH é‡‘é‘°å°
ssh-keygen -t ed25519 -C "github-actions-deploy" -f ~/.ssh/github_deploy

# å°‡å…¬é‘°åŠ å…¥ä¼ºæœå™¨
ssh-copy-id -i ~/.ssh/github_deploy.pub user@your-server

# è¤‡è£½ç§é‘°å…§å®¹åˆ° GitHub Secret
cat ~/.ssh/github_deploy
```

## ğŸš€ ä½¿ç”¨æ–¹å¼

### è‡ªå‹•è§¸ç™¼

- **æ¨é€åˆ° `develop` åˆ†æ”¯** â†’ è‡ªå‹•éƒ¨ç½²åˆ°é–‹ç™¼ç’°å¢ƒ
- **æ¨é€åˆ° `main` åˆ†æ”¯** â†’ è‡ªå‹•éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ

### æ‰‹å‹•è§¸ç™¼

1. å‰å¾€ GitHub Repository â†’ **Actions**
2. é¸æ“‡ **Deploy to Development** æˆ– **Deploy to Production**
3. é»æ“Š **Run workflow**

## ğŸ“‹ CI/CD æµç¨‹èªªæ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CI/CD æµç¨‹                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  1. GitHub Actions è§¸ç™¼                              â”‚
â”‚     â””â”€â”€ æ¨é€åˆ° develop/main åˆ†æ”¯                    â”‚
â”‚                                                      â”‚
â”‚  2. SSH é€£ç·šåˆ°ä¼ºæœå™¨                                 â”‚
â”‚     â””â”€â”€ ä½¿ç”¨ GitHub Secrets ä¸­çš„é‡‘é‘°               â”‚
â”‚                                                      â”‚
â”‚  3. æ‹‰å–ä»£ç¢¼                                         â”‚
â”‚     â””â”€â”€ git pull origin <branch>                    â”‚
â”‚                                                      â”‚
â”‚  4. å»ºæ§‹æ–°ç‰ˆæœ¬                                       â”‚
â”‚     â””â”€â”€ éƒ¨ç½²åˆ° idle ç‰ˆæœ¬ï¼ˆè—ç¶ éƒ¨ç½²ï¼‰                 â”‚
â”‚                                                      â”‚
â”‚  5. åˆ‡æ›æµé‡                                         â”‚
â”‚     â””â”€â”€ é€é Nginx åˆ‡æ›åˆ°æ–°ç‰ˆæœ¬                      â”‚
â”‚                                                      â”‚
â”‚  6. å®Œæˆéƒ¨ç½²                                         â”‚
â”‚     â””â”€â”€ èˆŠç‰ˆæœ¬ä¿ç•™ä¾›å›æ»¾ä½¿ç”¨                         â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”™ å›æ»¾æ©Ÿåˆ¶

æ‰‹å‹•å›æ»¾ï¼š

```bash
# åœ¨ä¼ºæœå™¨ä¸ŠåŸ·è¡Œ
./deploy.sh rollback
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### GitHub Actions åŸ·è¡Œå¤±æ•—

1. æª¢æŸ¥ GitHub Actions æ—¥èªŒ
2. ç¢ºèª GitHub Secrets è¨­å®šæ­£ç¢º
3. ç¢ºèª SSH é€£ç·šå¯ç”¨

### SSH é€£ç·šå¤±æ•—

```bash
# æ¸¬è©¦ SSH é€£ç·š
ssh -i ~/.ssh/github_deploy user@your-server

# æª¢æŸ¥é˜²ç«ç‰†è¨­å®š
sudo ufw status

# ç¢ºèª SSH æœå‹™é‹è¡Œä¸­
sudo systemctl status sshd
```

### æœå‹™ç„¡æ³•å•Ÿå‹•

```bash
# æª¢æŸ¥ Docker ç‹€æ…‹
docker compose ps

# æŸ¥çœ‹ Docker æ—¥èªŒ
docker compose logs -f
```
