# ðŸ—ï¸ NotifyHub Backend æž¶æ§‹èªªæ˜Ž

## ç›®éŒ„

- [æ¦‚è¿°](#æ¦‚è¿°)
- [æŠ€è¡“æ£§](#æŠ€è¡“æ£§)
- [ç›®éŒ„çµæ§‹](#ç›®éŒ„çµæ§‹)
- [åˆ†å±¤æž¶æ§‹](#åˆ†å±¤æž¶æ§‹)
- [è³‡æ–™æµå‘](#è³‡æ–™æµå‘)
- [è³‡æ–™åº«è¨­è¨ˆ](#è³‡æ–™åº«è¨­è¨ˆ)
- [èªè­‰æ©Ÿåˆ¶](#èªè­‰æ©Ÿåˆ¶)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)

---

## æ¦‚è¿°

NotifyHub æ˜¯ä¸€å€‹å¤šæ¸ é“é€šçŸ¥æŽ¨é€å¹³å°ï¼Œæ”¯æ´ LINE å’Œ Telegram ç­‰é€šè¨Šæ¸ é“çš„è¨Šæ¯ç™¼é€ç®¡ç†ã€‚å¾Œç«¯æŽ¡ç”¨ CodeIgniter 4 æ¡†æž¶ï¼Œéµå¾ªåˆ†å±¤æž¶æ§‹è¨­è¨ˆã€‚

### æ ¸å¿ƒåŠŸèƒ½

- ðŸ” JWT èªè­‰èˆ‡æŽˆæ¬Š
- ðŸ‘¥ ä½¿ç”¨è€…ç®¡ç†
- ðŸ“¢ å¤šæ¸ é“é€šçŸ¥ç™¼é€ï¼ˆLINEã€Telegramï¼‰
- ðŸ“ è¨Šæ¯æ¨¡æ¿ç®¡ç†
- ðŸ”‘ API é‡‘é‘°ç®¡ç†
- ðŸ“Š ä½¿ç”¨çµ±è¨ˆèˆ‡å„€è¡¨æ¿

---

## æŠ€è¡“æ£§

| é¡žåˆ¥ | æŠ€è¡“ |
|------|------|
| **æ¡†æž¶** | CodeIgniter 4.6.4 |
| **èªžè¨€** | PHP 8.3 |
| **è³‡æ–™åº«** | MariaDB 10.11 |
| **èªè­‰** | JWT (firebase/php-jwt) |
| **LINE SDK** | linecorp/line-bot-sdk |
| **HTTP å®¢æˆ¶ç«¯** | GuzzleHttp |
| **å®¹å™¨åŒ–** | Docker, Docker Compose |

---

## ç›®éŒ„çµæ§‹

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Config/              # æ¡†æž¶è¨­å®š
â”‚   â”‚   â”œâ”€â”€ Database.php     # è³‡æ–™åº«é€£ç·šè¨­å®š
â”‚   â”‚   â”œâ”€â”€ Filters.php      # éŽæ¿¾å™¨è¨­å®š
â”‚   â”‚   â”œâ”€â”€ Routes.php       # è·¯ç”±è¨­å®š
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ Controllers/         # æŽ§åˆ¶å™¨å±¤
â”‚   â”‚   â”œâ”€â”€ BaseController.php
â”‚   â”‚   â”œâ”€â”€ AuthController.php
â”‚   â”‚   â”œâ”€â”€ UserController.php
â”‚   â”‚   â”œâ”€â”€ ChannelController.php
â”‚   â”‚   â”œâ”€â”€ MessageController.php
â”‚   â”‚   â”œâ”€â”€ TemplateController.php
â”‚   â”‚   â”œâ”€â”€ ApiKeyController.php
â”‚   â”‚   â”œâ”€â”€ ApiUsageController.php
â”‚   â”‚   â””â”€â”€ StatsController.php
â”‚   â”‚
â”‚   â”œâ”€â”€ Services/            # æœå‹™å±¤ï¼ˆæ¥­å‹™é‚è¼¯ï¼‰
â”‚   â”‚   â”œâ”€â”€ AuthService.php
â”‚   â”‚   â”œâ”€â”€ UserService.php
â”‚   â”‚   â”œâ”€â”€ ChannelService.php
â”‚   â”‚   â””â”€â”€ MessageService.php
â”‚   â”‚
â”‚   â”œâ”€â”€ Repositories/        # è³‡æ–™å­˜å–å±¤
â”‚   â”‚   â”œâ”€â”€ BaseRepository.php
â”‚   â”‚   â”œâ”€â”€ UserRepository.php
â”‚   â”‚   â”œâ”€â”€ ChannelRepository.php
â”‚   â”‚   â”œâ”€â”€ MessageRepository.php
â”‚   â”‚   â”œâ”€â”€ TemplateRepository.php
â”‚   â”‚   â””â”€â”€ ApiKeyRepository.php
â”‚   â”‚
â”‚   â”œâ”€â”€ Entities/            # å¯¦é«”å±¤ï¼ˆè³‡æ–™æ¨¡åž‹ï¼‰
â”‚   â”‚   â”œâ”€â”€ UserEntity.php
â”‚   â”‚   â”œâ”€â”€ ChannelEntity.php
â”‚   â”‚   â”œâ”€â”€ MessageEntity.php
â”‚   â”‚   â”œâ”€â”€ TemplateEntity.php
â”‚   â”‚   â””â”€â”€ ApiKeyEntity.php
â”‚   â”‚
â”‚   â”œâ”€â”€ Filters/             # éŽæ¿¾å™¨ï¼ˆä¸­ä»‹å±¤ï¼‰
â”‚   â”‚   â”œâ”€â”€ AuthFilter.php   # JWT èªè­‰
â”‚   â”‚   â”œâ”€â”€ AdminFilter.php  # ç®¡ç†å“¡æ¬Šé™
â”‚   â”‚   â””â”€â”€ CorsFilter.php   # è·¨åŸŸè«‹æ±‚
â”‚   â”‚
â”‚   â””â”€â”€ Database/
â”‚       â””â”€â”€ Seeds/
â”‚           â””â”€â”€ AdminSeeder.php  # é è¨­å¸³è™Ÿ
â”‚
â”œâ”€â”€ docs/                    # æ–‡ä»¶
â”‚   â”œâ”€â”€ API.md
â”‚   â””â”€â”€ ARCHITECTURE.md
â”‚
â”œâ”€â”€ public/                  # Web å…¥å£
â”‚   â””â”€â”€ index.php
â”‚
â”œâ”€â”€ writable/                # å¯å¯«ç›®éŒ„
â”‚   â”œâ”€â”€ cache/
â”‚   â”œâ”€â”€ logs/
â”‚   â”œâ”€â”€ session/
â”‚   â””â”€â”€ uploads/
â”‚
â”œâ”€â”€ composer.json
â”œâ”€â”€ spark                    # CLI å·¥å…·
â””â”€â”€ .env                     # ç’°å¢ƒè®Šæ•¸
```

---

## åˆ†å±¤æž¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        HTTP Request                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Filters (ä¸­ä»‹å±¤)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ CorsFilter  â”‚  â”‚ AuthFilter  â”‚  â”‚ AdminFilter â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Controllers (æŽ§åˆ¶å™¨å±¤)                    â”‚
â”‚  - è™•ç† HTTP è«‹æ±‚                                            â”‚
â”‚  - åƒæ•¸é©—è­‰                                                  â”‚
â”‚  - å‘¼å« Service                                              â”‚
â”‚  - å›žå‚³ JSON å›žæ‡‰                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Services (æœå‹™å±¤)                        â”‚
â”‚  - æ¥­å‹™é‚è¼¯è™•ç†                                              â”‚
â”‚  - é©—è­‰è¦å‰‡                                                  â”‚
â”‚  - è·¨ Repository å”èª¿                                        â”‚
â”‚  - å¤–éƒ¨ API æ•´åˆï¼ˆLINEã€Telegramï¼‰                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Repositories (è³‡æ–™å­˜å–å±¤)                  â”‚
â”‚  - CRUD æ“ä½œ                                                 â”‚
â”‚  - è³‡æ–™æŸ¥è©¢                                                  â”‚
â”‚  - è³‡æ–™è½‰æ›                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Entities (å¯¦é«”å±¤)                        â”‚
â”‚  - è³‡æ–™çµæ§‹å®šç¾©                                              â”‚
â”‚  - è³‡æ–™é©—è­‰æ–¹æ³•                                              â”‚
â”‚  - è³‡æ–™è½‰æ›æ–¹æ³•                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Database                               â”‚
â”‚                     (MariaDB)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å„å±¤è·è²¬

| å±¤ç´š | è·è²¬ | ç¯„ä¾‹ |
|------|------|------|
| **Controller** | è™•ç† HTTP è«‹æ±‚ã€å›žæ‡‰æ ¼å¼åŒ– | é©—è­‰åƒæ•¸ã€å‘¼å« Serviceã€å›žå‚³ JSON |
| **Service** | æ¥­å‹™é‚è¼¯ã€é©—è­‰è¦å‰‡ | ç™»å…¥é©—è­‰ã€ç™¼é€è¨Šæ¯é‚è¼¯ |
| **Repository** | è³‡æ–™åº« CRUD æ“ä½œ | æŸ¥è©¢ä½¿ç”¨è€…ã€æ–°å¢žè¨Šæ¯ |
| **Entity** | è³‡æ–™çµæ§‹å°è£ | å¯†ç¢¼é©—è­‰ã€è³‡æ–™è½‰æ› |
| **Filter** | è«‹æ±‚æ””æˆªã€èªè­‰æŽˆæ¬Š | JWT é©—è­‰ã€æ¬Šé™æª¢æŸ¥ |

---

## è³‡æ–™æµå‘

### ç¯„ä¾‹ï¼šä½¿ç”¨è€…ç™»å…¥

```
1. POST /api/auth/login
   â”‚
   â–¼
2. CorsFilter.before()
   - è¨­å®š CORS Headers
   â”‚
   â–¼
3. AuthController.login()
   - å–å¾— email, password
   - å‘¼å« AuthService
   â”‚
   â–¼
4. AuthService.login()
   - å‘¼å« UserRepository.findByEmail()
   - é©—è­‰å¯†ç¢¼
   - ç”Ÿæˆ JWT Token
   â”‚
   â–¼
5. UserRepository.findByEmail()
   - æŸ¥è©¢è³‡æ–™åº«
   - å›žå‚³ UserEntity
   â”‚
   â–¼
6. UserEntity
   - verifyPassword() é©—è­‰å¯†ç¢¼
   â”‚
   â–¼
7. å›žå‚³ JSON å›žæ‡‰
   {
     "success": true,
     "data": {
       "user": { ... },
       "token": "eyJ..."
     }
   }
```

### ç¯„ä¾‹ï¼šç™¼é€è¨Šæ¯

```
1. POST /api/messages/send
   â”‚
   â–¼
2. AuthFilter.before()
   - é©—è­‰ JWT Token
   - è¨­å®š request.user
   â”‚
   â–¼
3. MessageController.send()
   - å–å¾— title, content, channelIds
   - å‘¼å« MessageService
   â”‚
   â–¼
4. MessageService.sendMessage()
   - å»ºç«‹ Message è¨˜éŒ„
   - éæ­· channelIds
   â”‚
   â”œâ”€â–¶ ChannelRepository.find()
   â”‚   - å–å¾—æ¸ é“è¨­å®š
   â”‚
   â”œâ”€â–¶ sendToLine() / sendToTelegram()
   â”‚   - å‘¼å«å¤–éƒ¨ API
   â”‚
   â””â”€â–¶ MessageRepository.addResult()
       - è¨˜éŒ„ç™¼é€çµæžœ
   â”‚
   â–¼
5. å›žå‚³ JSON å›žæ‡‰
```

---

## è³‡æ–™åº«è¨­è¨ˆ

### ER åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users     â”‚         â”‚   channels   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)      â”‚         â”‚ id (PK)      â”‚
â”‚ username     â”‚         â”‚ type         â”‚
â”‚ email        â”‚         â”‚ name         â”‚
â”‚ password     â”‚         â”‚ enabled      â”‚
â”‚ role         â”‚         â”‚ config       â”‚
â”‚ status       â”‚         â”‚ created_at   â”‚
â”‚ avatar       â”‚         â”‚ updated_at   â”‚
â”‚ created_at   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ updated_at   â”‚                â”‚
â”‚ last_login_atâ”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
       â”‚                        â”‚
       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚    â”‚
       â–¼    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     messages     â”‚      â”‚ message_results  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)          â”‚â”€â”€â”€â”€â”€â”€â”‚ message_id (FK)  â”‚
â”‚ user_id (FK)     â”‚      â”‚ channel_id (FK)  â”‚
â”‚ title            â”‚      â”‚ success          â”‚
â”‚ content          â”‚      â”‚ error            â”‚
â”‚ status           â”‚      â”‚ sent_at          â”‚
â”‚ channel_ids      â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ scheduled_at     â”‚
â”‚ sent_at          â”‚
â”‚ created_at       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  templates   â”‚         â”‚    api_keys      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)      â”‚         â”‚ id (PK)          â”‚
â”‚ name         â”‚         â”‚ user_id (FK)     â”‚
â”‚ title        â”‚         â”‚ name             â”‚
â”‚ content      â”‚         â”‚ key              â”‚
â”‚ channel_typesâ”‚         â”‚ prefix           â”‚
â”‚ variables    â”‚         â”‚ permissions      â”‚
â”‚ created_at   â”‚         â”‚ rate_limit       â”‚
â”‚ updated_at   â”‚         â”‚ usage_count      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ enabled          â”‚
                         â”‚ expires_at       â”‚
                         â”‚ last_used_at     â”‚
                         â”‚ created_at       â”‚
                         â”‚ updated_at       â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ api_usage_logs   â”‚
                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                         â”‚ id (PK)          â”‚
                         â”‚ api_key_id (FK)  â”‚
                         â”‚ endpoint         â”‚
                         â”‚ method           â”‚
                         â”‚ status_code      â”‚
                         â”‚ success          â”‚
                         â”‚ response_time    â”‚
                         â”‚ ip               â”‚
                         â”‚ user_agent       â”‚
                         â”‚ request_body     â”‚
                         â”‚ error_message    â”‚
                         â”‚ created_at       â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è³‡æ–™è¡¨èªªæ˜Ž

| è¡¨å | èªªæ˜Ž |
|------|------|
| `users` | ä½¿ç”¨è€…å¸³è™Ÿ |
| `channels` | é€šçŸ¥æ¸ é“ï¼ˆLINEã€Telegramï¼‰ |
| `messages` | é€šçŸ¥è¨Šæ¯ |
| `message_results` | è¨Šæ¯ç™¼é€çµæžœ |
| `templates` | è¨Šæ¯æ¨¡æ¿ |
| `api_keys` | API é‡‘é‘° |
| `api_usage_logs` | API ä½¿ç”¨ç´€éŒ„ |

---

## èªè­‰æ©Ÿåˆ¶

### JWT Token çµæ§‹

```json
{
  "iss": "notifyhub",
  "iat": 1703500000,
  "exp": 1703586400,
  "sub": "user-uuid",
  "email": "admin@notifyhub.com",
  "role": "admin"
}
```

### èªè­‰æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚          â”‚   Backend   â”‚          â”‚  Database   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                      â”‚                        â”‚
     â”‚  POST /auth/login    â”‚                        â”‚
     â”‚ {email, password}    â”‚                        â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
     â”‚                      â”‚                        â”‚
     â”‚                      â”‚  SELECT * FROM users   â”‚
     â”‚                      â”‚ WHERE email = ?        â”‚
     â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                      â”‚                        â”‚
     â”‚                      â”‚     user data          â”‚
     â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                      â”‚                        â”‚
     â”‚                      â”‚ verify password        â”‚
     â”‚                      â”‚ generate JWT           â”‚
     â”‚                      â”‚                        â”‚
     â”‚   {user, token}      â”‚                        â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
     â”‚                      â”‚                        â”‚
     â”‚  GET /api/users      â”‚                        â”‚
     â”‚  Authorization:      â”‚                        â”‚
     â”‚  Bearer <token>      â”‚                        â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
     â”‚                      â”‚                        â”‚
     â”‚                      â”‚ AuthFilter:            â”‚
     â”‚                      â”‚ - decode JWT           â”‚
     â”‚                      â”‚ - verify signature     â”‚
     â”‚                      â”‚ - check expiration     â”‚
     â”‚                      â”‚                        â”‚
     â”‚   {users: [...]}     â”‚                        â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
```

### æ¬Šé™æŽ§åˆ¶

| è§’è‰² | æ¬Šé™ |
|------|------|
| `admin` | æ‰€æœ‰åŠŸèƒ½ |
| `user` | é™¤ä½¿ç”¨è€…ç®¡ç†å¤–çš„æ‰€æœ‰åŠŸèƒ½ |

---

## éƒ¨ç½²æŒ‡å—

### æœ¬åœ°é–‹ç™¼

```bash
# 1. é€²å…¥å°ˆæ¡ˆç›®éŒ„
cd notification

# 2. å•Ÿå‹• Docker
docker compose up -d

# 3. ç­‰å¾…å•Ÿå‹•å®Œæˆ
docker compose logs -f backend

# 4. åŸ·è¡Œ Seeder
docker compose exec backend php spark db:seed AdminSeeder
```

### ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸ | èªªæ˜Ž | é è¨­å€¼ |
|------|------|--------|
| `JWT_SECRET` | JWT ç°½åå¯†é‘° | è‡ªå‹•ç”Ÿæˆ |
| `DATABASE_HOSTNAME` | è³‡æ–™åº«ä¸»æ©Ÿ | mariadb |
| `DATABASE_DATABASE` | è³‡æ–™åº«åç¨± | notifyhub |
| `DATABASE_USERNAME` | è³‡æ–™åº«ä½¿ç”¨è€… | notifyhub |
| `DATABASE_PASSWORD` | è³‡æ–™åº«å¯†ç¢¼ | notifyhub_db_2024 |

### é è¨­å¸³è™Ÿ

| Email | å¯†ç¢¼ | è§’è‰² |
|-------|------|------|
| admin@notifyhub.com | admin123 | admin |
| user@notifyhub.com | admin123 | user |

---

*æœ€å¾Œæ›´æ–°ï¼š2024-12-26*
